var traceroute_in_progress=false;var conn=null;var is_busy=false;var current_sequence=0;var traceroute_url="";var traceroute_hop=0;var max_hops=30;var traceroute_form=null;function setElementHtml(c,a){var b=document.getElementById(c);if(b){b.innerHTML=a;return true}return false}function addRow(h,c){var b;var a=document.getElementById(h).getElementsByTagName("TBODY")[0];var e=document.createElement("TR");var g;var d=new Array("15px","170px","90px","");for(b=0;b<c.length;++b){g=document.createElement("TD");if(d[b].length>0){g.style.width=d[b];g.style.overflow="hidden"}g.innerHTML=c[b];e.appendChild(g)}a.appendChild(e);e.style.width="100%";var f=document.getElementById("scroll_results");if(f){f.scrollTop=f.scrollHeight}}function clearTable(e){var c;var b=document.getElementById(e).getElementsByTagName("TBODY")[0];var d=b.getElementsByTagName("TR");for(c=0;c<d.length;){var a=d[c].sectionRowIndex;b.deleteRow(a)}}function addResult(a,b,d,c){addRow("tr_results",new Array(a,b,d,c))}function handleResponse(a){var b=-255;try{if(a&&a.status!=200){return -2}if(a&&a.status==200){results=a.responseText.split("|");if(results.length>0){b=parseInt(results[0])}}}catch(c){}if(b||results.length!=8){addResult("x",traceroute_l10n_fail,"x","x");return -1}addResult(results[1],'<input type="text" readonly style="border: none; width: 170px; background-color: transparent;" value="'+results[2]+'">',results[3],results[4]+" &middot; "+results[5]+" &middot; "+results[6]);return(parseInt(results[7])!=1)?0:-1}function tracerouteAction(b){var a=b;is_busy=true;if(!conn.get(getTracerouteUrl(),function(c){if(a!=current_sequence){return}is_busy=false;if(!traceroute_in_progress){return}var d=handleResponse(c);if(d==0&&traceroute_hop<max_hops){doTraceroute()}else{stopTraceroute();if(d==-2){window.location.reload()}}})){is_busy=false;addResult("x","x","x",traceroute_l10n_msg_unable_initialize);stopTraceroute();return false}return true}function getTracerouteUrl(){traceroute_hop++;return traceroute_url+"&hop="+traceroute_hop+"&q="+Math.random()}function initTraceroute(){if(conn){abortConnection()}else{conn=new ajax()}var a=traceroute_form.dst_host.value;if(conn==null||a.length==0){return false}var c=traceroute_form.resolve.checked;var b="action=traceroute";b=b+"&dst_host="+a;if(c){b=b+"&resolve=1"}traceroute_url="traceroute_action.cgi?"+b;traceroute_hop=0;return true}function doTraceroute(){if(traceroute_in_progress){abortConnection();tracerouteAction(current_sequence)}}function startTraceroute(a){traceroute_form=a;if(traceroute_in_progress){return false}if(!initTraceroute()){return false}traceroute_in_progress=true;tracerouteStarted();doTraceroute();return true}function abortConnection(){if(conn&&is_busy){conn.abort();is_busy=false;return true}return false}function stopTraceroute(){traceroute_in_progress=false;current_sequence++;abortConnection();tracerouteStopped()}function _traceroute(a){if(traceroute_in_progress){stopTraceroute()}else{startTraceroute(a)}}function tracerouteStarted(){var a=document.getElementById("tr_start");if(a){a.value=l10n_stop}setDisabled(traceroute_form.dst_host,true);setDisabled(traceroute_form.resolve,true);clearTable("tr_results")}function tracerouteStopped(){var a=document.getElementById("tr_start");if(a){a.value=l10n_start}setDisabled(traceroute_form.dst_host,false);setDisabled(traceroute_form.resolve,false)};