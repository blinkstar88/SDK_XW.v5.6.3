var _cols={mac:0,name:1,tx_signal:2,rx_signal:3,noise:4,latency:5,beam:6,distance:7,txrx:8,ccq:9,uptime:10,ip:11,action:12,rate_count:13,aprepeater:14};if(typeof jsTranslate=="undefined"){jsTranslate=function(a){return a}}var _toggle={distance:{col:_cols.distance,id:"#distance_label",value:false,lbl_true:jsTranslate("km"),lbl_false:jsTranslate("miles")},rx_signal:{col:_cols.rx_signal,id:"#rx_details",value:false,lbl_true:jsTranslate("Chain0/Chain1"),lbl_false:jsTranslate("Combined")},tx_signal:{col:_cols.tx_signal,id:"#tx_details",value:false,lbl_true:jsTranslate("Chain0/Chain1"),lbl_false:jsTranslate("Combined")}};function handleError(b,c,a){if(b&&b.status!=200&&b.status!=0){window.location.reload()}}function kickEnd(a,c,b){$(this).enable();refreshStaList()}function kickStation(b,e,d){$(b).parent().parent("tr").hide();var c="/stakick.cgi?staif="+e+"&staid="+d;$.ajax({url:c,cache:false,dataType:"json",success:kickEnd,error:handleError});return false}function refreshStaList(){$.ajax({cache:false,url:"/sta.cgi",dataType:"json",success:showStaList,error:handleError,complete:function(a,b){if(b!="success"){refreshStaList()}}})}function refreshAll(){if(typeof reloadStatus=="function"){reloadStatus()}refreshStaList()}function getSignalDetails(j,h,e,b){var a={combined:j};if(e){var c=j-h;var g=[];var d=3;for(var f=0;f<d;f++){if(e&(1<<f)){g.push(b[f]+c)}}a.per_chain=g.join(" / ")}else{a.per_chain="-"}return a}function getStaInfo(b){var d=null;if(typeof b.remote!="undefined"){var c=b.remote;if(c.signal){d=getSignalDetails(c.signal,c.rssi,c.rx_chainmask,c.chainrssi)}if(c.hostname){b.name=c.hostname}}var a=[b.mac,b.name?b.name:"-",d,getSignalDetails(b.signal,b.rssi,b.rx_chainmask,b.chainrssi),b.noisefloor,b.tx_latency,(sl_global.airmax_on&&sl_global.phased_array)?b.airmax.beam:0,sl_global.autoack?(b.ack>0?b.distance:sl_global.distance):0,b.tx+" / "+b.rx,b.ccq,b.uptime,b.lastip,0,b.rates.length,b.aprepeater];return a}function showStaList(b){var e=$("#sta_list").dataTable();e.fnClearTable();for(var d=0;d<b.length;++d){var c=b[d];var a=e.fnAddData(getStaInfo(c),true)}}function tableCell(b,c){var d=$("#sta_list").dataTable();var a=d.oApi._fnColumnIndexToVisible(d.fnSettings(),c);if(a==null){return $()}return $("td",b).eq(a)}function updateMac(e,c){var a=c[_cols.rate_count]>8?520:400;var d="openPage('stainfo.cgi?ifname="+sl_global.wlan_iface;d+="&sta_mac="+c[_cols.mac]+"', 700, "+a+");";var b='<a href="#" onClick="'+d+'">'+c[_cols.mac]+"</a>";b+=((c[_cols.aprepeater]==0)?"":"&nbsp;("+jsTranslate("AP-Repeater")+")");b+="&nbsp;&nbsp;&nbsp;";tableCell(e,_cols.mac).html(b)}function updateName(b,a){if(a[_cols.name].length>0){tableCell(b,_cols.name).text(a[_cols.name])}else{tableCell(b,_cols.name).html("&nbsp;")}}function updateCcq(b,a){if(a[_cols.ccq]<=0){tableCell(b,_cols.ccq).text("-")}}function updateUptime(c,b){var a=secsToCountdown(b[_cols.uptime],jsTranslate("day"),jsTranslate("days"));tableCell(c,_cols.uptime).text(a)}function updateIp(c,b){var a=b[_cols.ip]!="0.0.0.0"?'<a href="http://'+b[_cols.ip]+'" target="_blank">'+b[_cols.ip]+"</a>":jsTranslate("unknown");tableCell(c,_cols.ip).html(a)}function updateAction(c,a){var b="&nbsp;";if(a[_cols.aprepeater]==0){b='<a href="#" onClick="return kickStation(this, \''+sl_global.wlan_iface+"', '"+a[_cols.mac]+"');\">"+jsTranslate("kick")+"</a>"}tableCell(c,_cols.action).html(b)}function updateRow(d,c,a,b){updateMac(d,c);updateName(d,c);updateCcq(d,c);updateUptime(d,c);updateIp(d,c);updateAction(d,c);return d}function toggleColData(b){b.value=!b.value;$(b.id).text(b.value?b.lbl_true:b.lbl_false);var a=$("#sta_list").dataTable();$.each(a.fnGetData(),function(c,d){a.fnUpdate(d[b.col],c,b.col)})}function renderDistance(d,a,e){if(!sl_global.autoack||(a!=="display"&&a!=="filter")){return d}var c=_toggle.distance;var f=(d<150)?150:d;var b=c.value?1000:1609.344;return toFixed(f/b,1)}function renderAirBeam(d,c,e){if(!sl_global.airmax_on||!sl_global.phased_array){return 0}if(c==="display"||c==="filter"){var b=sl_global.beam_angles.length;var a=d<b?d:b-1;return sl_global.beam_angles[a]}return d}function renderSignal(c,b,a){if(c){if(a||b==="type"||b==="sort"){return c.combined}else{return c.per_chain}}if(b==="sort"||b==="type"){return 0}return"-"}function renderRxSignal(b,a,c){return renderSignal(b,a,!_toggle.rx_signal.value)}function renderTxSignal(b,a,c){return renderSignal(b,a,!_toggle.tx_signal.value)}$(document).ready(function(){if($.fn.dataTable.isDataTable("#sta_list")){return}var a=$("#sta_list").dataTable({aaSorting:[[1,"asc"]],bLengthChange:false,bPaginate:false,bFilter:false,bInfo:false,bSortClasses:false,bAutoWidth:false,oLanguage:{sEmptyTable:jsTranslate("Loading...")},fnRowCallback:updateRow,fnInitComplete:function(b){b.oLanguage.sEmptyTable=jsTranslate("No Associated Stations")},aoColumnDefs:[{sClass:"centered",aTargets:[_cols.rx_signal,_cols.tx_signal,_cols.noise,_cols.latency,_cols.beam,_cols.distance,_cols.txrx,_cols.ccq,_cols.action]},{sClass:"uptime",aTargets:[_cols.uptime]},{bSortable:false,aTargets:[_cols.action]},{bVisible:false,aTargets:[_cols.rate_count,_cols.aprepeater]},{bVisible:sl_global.autoack,aTargets:[_cols.latency,_cols.distance]},{bVisible:(sl_global.airmax_on&&sl_global.phased_array),aTargets:[_cols.beam]},{sType:"string",render:renderAirBeam,aTargets:[_cols.beam]},{sType:"number",aTargets:[_cols.rx_signal,_cols.tx_signal]},{render:renderDistance,aTargets:[_cols.distance]},{render:renderTxSignal,aTargets:[_cols.tx_signal]},{render:renderRxSignal,aTargets:[_cols.rx_signal]}]});$("#_refresh").click(refreshAll);$("#sta_list th").removeClass("initial_hide");$(".disable_sort").unbind("click.DT").bind("click.DT",function(b){$(this).blur()});a.fnSortListener(document.getElementById("rx_signal_sort"),_cols.rx_signal);a.fnSortListener(document.getElementById("tx_signal_sort"),_cols.tx_signal);a.fnSortListener(document.getElementById("distance_sort"),_cols.distance);$("#rx_details").on("click",function(b){toggleColData(_toggle.rx_signal)});$("#tx_details").on("click",function(b){toggleColData(_toggle.tx_signal)});$("#distance_label").on("click",function(b){toggleColData(_toggle.distance)});refreshStaList()});$.fn.dataTableExt.aTypes.push(function(a){if(/^\d{1,3}[\.]\d{1,3}[\.]\d{1,3}[\.]\d{1,3}$/.test(a)){return"ip-address"}return null});$.fn.dataTableExt.oApi.fnSortByIp=function(g,f,h){var c=g.split(".");var a=f.split(".");var e=h?-1:1;for(var d=0;d<c.length&&d<a.length;++d){var b=parseInt(c[d]),j=parseInt(a[d]);if(b!=j){return((b<j)?e:-e)}}return 0};$.fn.dataTableExt.oSort["ip-address-asc"]=function(d,c){return $.fn.dataTableExt.oApi.fnSortByIp(d,c,true)};$.fn.dataTableExt.oSort["ip-address-desc"]=function(d,c){return $.fn.dataTableExt.oApi.fnSortByIp(d,c,false)};$.fn.dataTableExt.oApi.fnSortByRate=function(c,b,h){var e=c.split(/\s+/);var a=b.split(/\s+/);var g=h?-1:1;for(var f=0;f<e.length&&f<a.length;++f){var d=Number(e[f]);if(isNaN(d)){d=0}var j=Number(a[f]);if(isNaN(j)){j=0}if(d!=j){return((d<j)?g:-g)}}return 0};$.fn.dataTableExt.oSort["rate-asc"]=function(d,c){return $.fn.dataTableExt.oApi.fnSortByRate(d,c,true)};$.fn.dataTableExt.oSort["rate-desc"]=function(d,c){return $.fn.dataTableExt.oApi.fnSortByRate(d,c,false)};$.fn.dataTableExt.oSort["signal-asc"]=function(d,c){return $.fn.dataTableExt.oApi.fnSortByRate(d,c,true)};$.fn.dataTableExt.oSort["signal-desc"]=function(d,c){return $.fn.dataTableExt.oApi.fnSortByRate(d,c,false)};