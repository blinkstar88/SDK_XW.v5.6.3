var si_refresh_timeout=0;var bps_info={_rx:0,_tx:0,_uptime:0,rxbps:0,txbps:0,update:function(c,a,b){var d=b-this._uptime;if(d!=0){this.rxbps=(c-this._rx)/(d);this.txbps=(a-this._tx)/(d)}this._rx=c;this._tx=a;this._uptime=b}};function setHeading(a){var b;if(si_global.mode=="ap"){b=jsTranslate("Access Point")+" &nbsp; &nbsp; &nbsp; &nbsp; "+a.mac}else{b=jsTranslate("Station")+" &nbsp; &nbsp; &nbsp; &nbsp; "+a.mac;if(a.aprepeater!=0){b+=" ("+jsTranslate("AP-Repeater")+")"}b+=" &nbsp; &nbsp; [ "+a.associd+" ]"}$("#si_heading").html(b)}function setAck(f,e){var d=(e<150)?150:e;var b=toFixed(d/1000,1);var a=toFixed(d/1609.344,1);var c=[a,jsTranslate("miles"),"("+b,"km)"];$("#si_ack").text(c.join(" "))}function decodeAirMaxPri(b){var a;switch(b){case 0:a=jsTranslate("High");break;case 1:a=jsTranslate("Medium");break;case 2:a=jsTranslate("Low");break;default:a=jsTranslate("None")}return a}function formatRate(a){if(a>0){return""+a+" Mbps"}else{return" - "}}function formatBytes(a){var b=""+a;if(a>1000*1000*1000){b+=" ("+toFixed(a/(1000*1000*1000),2)+" GBytes)"}else{if(a>1000*1000){b+=" ("+toFixed(a/(1000*1000),2)+" MBytes)"}else{if(a>1000){b+=" ("+toFixed(a/1000,2)+" kBytes)"}}}return b}function format_bps(b){var c=b*8;var a=""+toFixed(c,2)+" bps";if(c>1000*1000*1000){a=""+toFixed(c/(1000*1000*1000),2)+" Gbps"}else{if(c>1000*1000){a=""+toFixed(c/(1000*1000),2)+" Mbps"}else{if(c>1000){a=""+toFixed(c/1000,2)+" kbps"}}}return a}function fillRates(b){$("#si_rate_tbl > tbody").empty();var a=[];for(var c=0;c<b.rates.length;++c){var e=[];e.push("<tr>");e.push('<td align="center">'+b.rates[c]+"</td>");var d=(b.signals[c]!=0&&b.signals[c]!=-96)?b.signals[c]:jsTranslate("N/A");e.push('<td align="center">'+d+"</td>");e.push("</tr>");a.push(e.join(""))}$("#si_rate_tbl > tbody").append(a.join(""))}var discovery=new function(){var f=false;var i=null;var d,e,c,b;var g=[500,2000,5000];var h=function(){d=null;e=null;c=null;b=0;if(i){i.abort();i=null}};this.check=function(j){f=(j.name.length>0&&j.lastip!="0.0.0.0");if(f){if(e!=j.mac||c!=j.lastip){h();c=j.lastip;e=j.mac}if(!i){this.load()}}else{h()}};this.load=function(){if(b>=g.length){return}var j=this;var l=(b<g.length)?g[b]:g[g.length-1];var k={};k.discover="y";k.duration=l;if(c){k.host=c}i=$.ajax({type:"GET",url:"/discovery.cgi",dataType:"json",cache:false,data:k,success:function(m){d=m;if(j.getInfo(e)){j.update()}else{j.load()}},error:function(){j.load()},timeout:l+5000});b++};this.getInfo=function(k){if(!d||!d.devices||!d.devices.length){return null}for(var j=0;j<d.devices.length;++j){if(d.devices[j].hwaddr==k){return d.devices[j]}}return null};this.update=function(){if(f){var l="-",j="-";var k=this.getInfo(e);if(k){name=k.name;l=k.product;j=a(k.fwversion)}$("#si_product").text(l);$("#si_fwversion").text(j)}$(".si_info").toggle(f)};var a=function(k){var j=/^\w+\.\w+\.(.+)\.\d+\.\d+\.\d+$/;rg_res=j.exec(k);if(rg_res!=null){return rg_res[1]}return"&nbsp;"}};function showTxPower(a){var b=(typeof a.remote!="undefined"&&typeof a.remote.tx_power!="undefined");$("#tx_power_row").toggle(b);$("#si_tx_power").text(b?""+a.remote.tx_power+" dBm":"-")}function loadStaInfo(e){var b=null;for(var d=0;d<e.length;++d){var c=e[d];if(c.mac==si_global.sta_mac){b=c;break}}if(!b){$("#si_details").hide();$("#si_kick").hide();if(si_global.sta_mac!="00:00:00:00:00:00"){$("#si_heading").text("[ "+si_global.sta_mac+" ] "+jsTranslate("Not Associated"))}else{$("#si_heading").text(jsTranslate("Not Associated"))}return}setHeading(b);$("#si_uptime").text(secsToCountdown(b.uptime,jsTranslate("day"),jsTranslate("days")));if(typeof b.remote!="undefined"){$("#si_name").html(b.remote.hostname?b.remote.hostname.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"-");$("#si_product").html(b.remote.platform?b.remote.platform.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"-");$("#si_fwversion").html(b.remote.version?b.remote.version.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"-")}else{$("#si_name").html(b.name?b.name.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"-");discovery.check(b)}if((typeof c.remote!="undefined")&&c.remote.signal){$("#si_signal_peer").text(""+c.remote.signal+" dBm");$("#si_signal_peer_row").show()}else{$("#si_signal_peer_row").hide()}$("#si_signal").text(""+b.signal+" dBm");if(b.chwidth!=null&&b.rates.length==16&&b.rx_chainmask==3){var a=b.signal-b.rssi;$("#si_signal_chain").text(""+rssi_to_signal(b.chainrssi[0],a)+" / "+rssi_to_signal(b.chainrssi[1],a)+" dBm");$("#si_signal_chain_row").show()}$("#si_noise").text(""+b.noisefloor+" dBm");if(si_global.autoack){setAck(b.ack,b.distance)}$("#si_ack_row").toggle(si_global.autoack);$("#si_ccq").text((b.ccq>0)?""+b.ccq+"%":"-");showTxPower(b);if(si_global.airmax_on){$("#si_amp").text(decodeAirMaxPri(b.airmax.priority));$("#si_amq").text(""+b.airmax.quality+"%");$("#si_amc").text(""+b.airmax.capacity+"%")}$(".si_airmax").toggle(si_global.airmax_on);if(si_global.airmax_on&&si_global.phased_array){$("#si_beam").html((b.airmax.beam<si_global.beam_angles.length?si_global.beam_angles[b.airmax.beam]:si_global.beam_angles[si_global.beam_angles.length-1]))}$(".si_airbeam").toggle(si_global.airmax_on&&si_global.phased_array);if(b.lastip!="0.0.0.0"){$("#si_lastip").html('<a href="http://'+b.lastip+'" target="_blank">'+b.lastip+"</a>")}else{$("#si_lastip").text(jsTranslate("unknown"))}$("#si_rate").text(formatRate(b.tx)+" / "+formatRate(b.rx));$("#si_packets").text(""+b.stats.tx_data+" / "+b.stats.rx_data);$("#si_packet_rate").text(""+b.stats.tx_pps+" / "+b.stats.rx_pps);bps_info.update(b.stats.rx_bytes,b.stats.tx_bytes,b.uptime);$("#si_bps").text(""+format_bps(bps_info.txbps)+" / "+format_bps(bps_info.rxbps));$("#si_txbytes").text(formatBytes(b.stats.tx_bytes));$("#si_rxbytes").text(formatBytes(b.stats.rx_bytes));fillRates(b);$("#si_details").show();if(b.aprepeater==0){$("#si_kick").disable(0).show()}if(typeof b.remote=="undefined"){discovery.update()}}function handleError(b,c,a){if(b&&b.status!=200&&b.status!=0){window.location.reload()}}function refreshStaInfo(){$.ajax({cache:false,url:"/sta.cgi",dataType:"json",success:loadStaInfo,error:handleError,complete:function(b,a){if(typeof refreshContent!="function"){if(si_refresh_timeout){clearTimeout(si_refresh_timeout)}si_refresh_timeout=setTimeout(refreshStaInfo,5000)}}});return false}function refreshAll(){if(typeof reloadStatus=="function"){reloadStatus()}refreshStaInfo()}function kickEnd(a,c,b){refreshStaInfo()}function kickStation(){$("#si_kick").disable();jQuery.ajax({url:kick_url,cache:false,dataType:"json",success:kickEnd,error:handleError});return false}$(document).ready(function(){$("#si_details").hide();$("#si_kick").hide();if(!window.opener){$("#si_close").hide()}refreshStaInfo()});