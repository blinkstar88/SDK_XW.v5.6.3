$(document).ready(function(){mainTable=$("#devices").dataTable({aaSorting:[[1,"asc"]],iDisplayLength:20,bLengthChange:false,bPaginate:true,bSortClasses:false,bAutoWidth:true,sPaginationType:"full_numbers",oLanguage:{sEmptyTable:jsTranslate("Loading..."),sProcessing:jsTranslate("Processing")+"...",sInfo:jsTranslate("msg_datatables_info|Showing _START_ to _END_ of _TOTAL_ entries"),sInfoEmpty:jsTranslate("Showing 0 to 0 of 0 entries"),sInfoFiltered:jsTranslate("(filtered from _MAX_ total entries)"),sSearch:jsTranslate("Search"),sZeroRecords:jsTranslate("No matching records found"),sUrl:"",oPaginate:{sFirst:"<<",sPrevious:"<",sNext:">",sLast:">>"}},fnRowCallback:function(e,d,c,b){if(d[ip_col].length>0){var a='<a href="http://'+d[ip_col]+'" target="_blank">'+d[ip_col]+"</a>";$("td:eq("+ip_col+")",e).html(a)}return e},fnInitComplete:function(a){a.oLanguage.sEmptyTable="No devices found."}});doDiscovery()});function doDiscovery(){var b=getInterval()[1];var a={};a.discover="y";a.duration=b;$.ajax({type:"GET",url:"discovery.cgi",dataType:"json",cache:false,data:a,success:processJSON,error:processError,complete:requestCompleted,timeout:b+5000});curr_poll++}function processJSON(a){updateData(a);if($("#loader").is(":visible")){$("#loader").hide();$("#results").show();$("#btn_row").show()}}function processError(c,a,b){if($("#loader").is(":visible")){$("#loader").hide()}}function requestCompleted(b,a){if(typeof requestCompleted.timeout=="undefined"){requestCompleted.timeout=0}if(requestCompleted.timeout){clearTimeout(requestCompleted.timeout)}requestCompleted.timeout=setTimeout(doDiscovery,getInterval()[0])}function getDeviceInfo(b){var a=[b.hwaddr,b.hostname,decodeWmode(b.wmode),b.essid,b.product,decodeFwVersion(b.fwversion),b.ipv4];$.each(a,function(c,d){if(d.length==0){a[c]="&nbsp;"}});return a}function addDevice(d,c,b){var a=mainTable.fnAddData(getDeviceInfo(c),true);mainTable.fnSettings().aoData[a[0]].nTr.id=d;devices[d]={last_seen:b,device:c}}function removeDevice(c,b){var a=mainTable.fnGetNodes();var d=$(a).filter("#"+c)[0];if(d){mainTable.fnDeleteRow(d,null,false);delete b}return(d!=null)}function updateData(e){var a=new Date();var g=mainTable.fnSettings()._iDisplayStart;for(var b=0;e&&b<e.devices.length;b++){var d=e.devices[b];var c=d.hwaddr.replace(/:/g,"");if(!devices[c]){addDevice(c,d,a)}else{if(devEquals(d,devices[c].device)){devices[c].last_seen=a}else{if(removeDevice(c,devices[c])){addDevice(c,d,a)}}}}for(var c in devices){var f=a-devices[c].last_seen;if(f>expire_after){removeDevice(c,devices[c])}}mainTable.fnSettings()._iDisplayStart=g;mainTable.fnDisplayStart(mainTable.fnSettings())}function getInterval(){return(curr_poll<intervals.length)?intervals[curr_poll]:intervals[intervals.length-1]}function decodeWmode(a){switch(a){case 2:return"STA";case 3:return"AP";default:return"-"}}function decodeFwVersion(b){var a=/^\w+\.[^\s\.]+\.(.+)\.\w+\.\d+\.\d+$/;rg_res=a.exec(b);if(rg_res!=null){return rg_res[1]}return"&nbsp;"}function devEquals(c,b){var a=["hostname","product","wmode"];for(prop in a){if(c[a[prop]]!=c[a[prop]]){return false}}return equals(c.addresses,b.addresses)}function hasProps(b,a){for(p in b){if(typeof(a[p])=="undefined"){return false}}return true}function equals(a,b){if(!hasProps(a,b)||!hasProps(b,a)){return false}for(p in a){switch(typeof(a[p])){case"object":if(!equals(a[p],b[p])){return false}break;case"function":if(a[p].toString()!=b[p].toString()){return false}break;default:if(a[p]!=b[p]){return false}}}return true}$.fn.dataTableExt.oApi.fnDisplayStart=function(a){a.oApi._fnCalculateEnd(a);a.oApi._fnDraw(a)};$.fn.dataTableExt.aTypes.push(function(a){if(/^\d{1,3}[\.]\d{1,3}[\.]\d{1,3}[\.]\d{1,3}$/.test(a)){return"ip-address"}return null});$.fn.dataTableExt.oApi.fnSortByIp=function(g,f,h){var c=g.split(".");var a=f.split(".");var e=h?-1:1;for(var d=0;d<c.length&&d<a.length;++d){var b=parseInt(c[d]),j=parseInt(a[d]);if(b!=j){return((b<j)?e:-e)}}return 0};$.fn.dataTableExt.oSort["ip-address-asc"]=function(d,c){return $.fn.dataTableExt.oApi.fnSortByIp(d,c,true)};$.fn.dataTableExt.oSort["ip-address-desc"]=function(d,c){return $.fn.dataTableExt.oApi.fnSortByIp(d,c,false)};